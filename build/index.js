/*!
 * 
 *   @budajeff/killer-game-logic v1.0.131
 *   https://github.com/budajeff/killer-game-logic
 *
 *   Copyright (c) Jeff Buda (https://github.com/budajeff) and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.KillerGameLogic=e():n.KillerGameLogic=e()}(self,(function(){return(()=>{"use strict";var n={d:(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o:(n,e)=>Object.prototype.hasOwnProperty.call(n,e),r:n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}},e={};n.r(e),n.d(e,{Card:()=>b,CardSequence:()=>i.CardSequence,GameState:()=>E,Play:()=>w,PlayerStatus:()=>u,Rank:()=>t,Suit:()=>r,cardToString:()=>g,createDeck:()=>C,findOfAKinds:()=>U,findRuns:()=>G,getActivePlayers:()=>P,getCurrentPlayer:()=>k,getNextPlayer:()=>D,getPassedPlayers:()=>S,orderBy:()=>x,transitionState:()=>W,transitionStateToHumanPlayer:()=>Q});var r,t,a,u,i={};function o(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.push.apply(r,t)}return r}function c(n){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){f(n,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))}))}return n}function f(n,e,r){return e in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function s(n){return function(n){if(Array.isArray(n))return h(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||d(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(n,e){var r="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=d(n))||e&&n&&"number"==typeof n.length){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(n){throw n},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,o=!1;return{s:function(){r=r.call(n)},n:function(){var n=r.next();return i=n.done,n},e:function(n){o=!0,u=n},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw u}}}}function d(n,e){if(n){if("string"==typeof n)return h(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(n,e):void 0}}function h(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function y(n,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function v(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function g(n){return function(n){switch(n){case t.Two:return"2";case t.Ace:return"A";case t.King:return"K";case t.Queen:return"Q";case t.Jack:return"J";case t.Ten:return"10";case t.Nine:return"9";case t.Eight:return"8";case t.Seven:return"7";case t.Six:return"6";case t.Five:return"5";case t.Four:return"4";case t.Three:return"3";default:return"?"}}(n.rank)+function(n){switch(n){case"hearts":return"♥";case"diamonds":return"♦";case"clubs":return"♧";case"spades":return"♠";default:return"?"}}(n.suit)}function p(n){return n.every((function(e){return e.rank===n[0].rank}))?function(n){switch(n){case 1:return a.OneOfAKind;case 2:return a.TwoOfAKind;case 3:return a.ThreeOfAKind;case 4:return a.FourOfAKind;default:return a.Unknown}}(n.length):function(n){switch(n){case 3:return a.RunOfThree;case 4:return a.RunOfFour;case 5:return a.RunOfFive;case 6:return a.RunOfSix;case 7:return a.RunOfSeven;case 8:return a.RunOfEight;case 9:return a.RunOfNine;case 10:return a.RunOfTen;case 11:return a.RunOfEleven;case 12:return a.RunOfTwelve;case 13:return a.RunOfThirteen;default:return a.Unknown}}(n.length)}function O(n){return n.reduce((function(n,e,r){return n+(g(e)+(r===n.length-1?"":" "))}),"")}n.r(i),n.d(i,{Zb:()=>b,D2:()=>E,sh:()=>w,cS:()=>u,yw:()=>t,hE:()=>r,VV:()=>g,tI:()=>C,L:()=>U,AY:()=>G,Pm:()=>P,JC:()=>k,uU:()=>D,eO:()=>S,Xo:()=>x,LG:()=>W,yC:()=>Q}),function(n){n.Hearts="hearts",n.Diamonds="diamonds",n.Clubs="clubs",n.Spades="spades"}(r||(r={})),function(n){n[n.Two=13]="Two",n[n.Ace=12]="Ace",n[n.King=11]="King",n[n.Queen=10]="Queen",n[n.Jack=9]="Jack",n[n.Ten=8]="Ten",n[n.Nine=7]="Nine",n[n.Eight=6]="Eight",n[n.Seven=5]="Seven",n[n.Six=4]="Six",n[n.Five=3]="Five",n[n.Four=2]="Four",n[n.Three=1]="Three"}(t||(t={})),function(n){n.Unknown="unknown",n.OneOfAKind="one of a kind",n.TwoOfAKind="two of a kind",n.ThreeOfAKind="three of a kind",n.FourOfAKind="four of a kind",n.RunOfThree="run of three",n.RunOfFour="run of four",n.RunOfFive="run of five",n.RunOfSix="run of six",n.RunOfSeven="run of seven",n.RunOfEight="run of eight",n.RunOfNine="run of nine",n.RunOfTen="run of ten",n.RunOfEleven="run of eleven",n.RunOfTwelve="run of twelve",n.RunOfThirteen="run of thirteen",n.RunOfThreePairs="run of three pairs",n.RunOfFourPairs="run of four pairs",n.RunOfFivePairs="run of five pairs",n.RunOfSixPairs="run of six pairs",n.RunOfThreeTriples="run of three triples",n.RunOfFourTriples="run of four triples"}(a||(a={})),function(n){n.InRound="in",n.PassedRound="passed"}(u||(u={}));var m,w=function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;v(this,n),this.player=e,this.cards=r},b=function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.Ace,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.Hearts;v(this,n),this.rank=e,this.suit=a};!function(n){n.Human="human",n.AI="ai"}(m||(m={}));var R=function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"player",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.AI,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u.InRound,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];v(this,n),this.name=e,this.kind=r,this.order=t,this.cards=a,this.status=i,this.current=o}var e,r,t;return e=n,(r=[{key:"toString",value:function(){var n;return"Player ".concat(this.name," with ").concat(null==this||null===(n=this.cards)||void 0===n?void 0:n.length," cards remaining")}}])&&y(e.prototype,r),t&&y(e,t),n}();function P(n){return n.players.filter((function(n){return n.status===u.InRound}))}function S(n){return n.players.filter((function(n){return n.status===u.PassedRound}))}function T(n,e){n.players.forEach((function(n){return n.current=!1})),e.current=!0}function k(n){return n.players.find((function(n){return n.current}))}function A(n){return n.players.some((function(n){return 0===n.cards.length}))}var j=function n(e,r){v(this,n),this.playerName=e,this.cards=r},E=function n(e,r,t,a){v(this,n),this.players=e,this.discardPile=r,this.message=t,this.error=a};function I(n,e){return n.rank>e.rank?1:n.rank<e.rank?-1:0}function K(n,e){return n.order>e.order?1:n.order<e.order?-1:0}function x(n){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(r,t){return r[n]>t[n]?e?1:-1:r[n]<t[n]?e?-1:1:0}}function F(n,e){if(e.length>4||e.length<2)throw new Error("invalid Player length");!function(n){for(var e,r=n.length;0!==r;){e=Math.floor(Math.random()*r),r--;var t=[n[e],n[r]];n[r]=t[0],n[e]=t[1]}}(n),e.forEach((function(e){return e.cards=n.splice(0,13)}))}function N(n){return Object.keys(n).filter((function(n){return Number.isNaN(+n)}))}function C(){var n,e=[],a=l(N(r));try{for(a.s();!(n=a.n()).done;){var u,i=n.value,o=l(N(t));try{for(o.s();!(u=o.n()).done;){var c=u.value;e.push({suit:r[i],rank:t[c]})}}catch(n){o.e(n)}finally{o.f()}}}catch(n){a.e(n)}finally{a.f()}return e}function D(n,e){var r=s(e).sort(K),t=r.indexOf(n);do{if(t===e.length-1?t=0:t+=1,r[t].status===u.InRound)return r[t]}while(r[t]!==n)}function U(n){for(var e=s(n).sort(I),r=[],t=[r];e.length>0;){var a=e.shift();0===r.length||r[r.length-1].rank===a.rank?r.push(a):(r=[a],t.push(r))}return t}function G(n){var e=[];return n.forEach((function(r){for(var t=[r],a=s(n),u=r.rank;a.find((function(n){return n.rank===u+1}));){var i=a.find((function(n){return n.rank===u+1})),o=a.indexOf(i);t.push(a.splice(o,1)[0]),u++}t.length>2&&e.push(t)})),e}function H(n){return[].concat(s(G(n)),s(U(n)))}function J(n,e){switch(e){case a.OneOfAKind:return U(n).filter((function(n){return 1===n.length}));case a.TwoOfAKind:return U(n).filter((function(n){return 2===n.length}));case a.ThreeOfAKind:return U(n).filter((function(n){return 3===n.length}));case a.FourOfAKind:return U(n).filter((function(n){return 4===n.length}));case a.RunOfThree:return G(n).filter((function(n){return 3===n.length}));case a.RunOfFour:return G(n).filter((function(n){return 4===n.length}));case a.RunOfFive:return G(n).filter((function(n){return 5===n.length}));case a.RunOfSix:return G(n).filter((function(n){return 6===n.length}));case a.RunOfSeven:return G(n).filter((function(n){return 7===n.length}));case a.RunOfEight:return G(n).filter((function(n){return 8===n.length}));case a.RunOfNine:return G(n).filter((function(n){return 9===n.length}));case a.RunOfTen:return G(n).filter((function(n){return 10===n.length}));case a.RunOfEleven:return G(n).filter((function(n){return 11===n.length}));case a.RunOfTwelve:return G(n).filter((function(n){return 12===n.length}));case a.RunOfThirteen:return G(n).filter((function(n){return 13===n.length}));default:return[]}}function M(n,e){return e.forEach((function(e){var r=n.cards.find((function(n){return n.rank===e.rank&&n.suit===e.suit})),t=n.cards.indexOf(r);if(!(t>-1))throw new Error("Player does not have card ".concat(g(e)));n.cards.splice(t,1)})),e}function L(n){return 0===n.discardPile.length?void 0:n.discardPile[n.discardPile.length-1]}function Q(n){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(n){console.log(n)};!A(n)&&!n.error&&k(n).kind===m.AI;){var r=k(n);if(0===n.discardPile.length){var t=H(r.cards);t.sort(x("length",!1)),e(n=W(n,new w(r,t[0])))}else if(r.name===L(n).playerName){var a=H(r.cards).sort(x("length",!1));e(n=W(n,new w(r,a[0])))}else{var u=p(L(n).cards),i=J(r.cards,u);e(n=0===i.length?W(n,new w(r,[])):W(n,new w(r,i[0])))}}return n}function W(){var n,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e){var t=[new R("A",m.Human,0),new R("B",m.AI,1),new R("C",m.AI,2),new R("D",m.AI,3)],i={players:t,error:"",discardPile:[],message:"New Game! Waiting on ".concat(t[0])};return T(i,i.players[0]),F(C(),i.players),i.players[0].current=!0,i}if((null==r||null===(n=r.cards)||void 0===n?void 0:n.length)>0&&p(r.cards)===a.Unknown)return c(c({},e),{},{message:"",error:"Unknown card sequence: ".concat(O(r.cards))});if(k(e)!==r.player)return c(c({},e),{},{error:"It is not ".concat(r.player.name,"'s turn. It is ").concat(k(e).name,"'s turn.")});var o=e.players.filter((function(n){return 0===n.cards.length}));if(o.length>0)return c(c({},e),{},{error:"".concat(o[0].name," won this game.")});if(!r.cards||0===r.cards.length){r.player.status=u.PassedRound;var f=c(c({},e),{},{error:""});return T(f,D(r.player,f.players)),f.message="".concat(r.player.name," passes. Waiting on ").concat(k(f).name),f}if(1===P(e).length){var l=c(c({},e),{},{error:"",discardPile:[].concat(s(e.discardPile),[new j(r.player.name,M(r.player,r.cards))])});return l.players.forEach((function(n){return n.status=u.InRound})),l.message="".concat(r.player.name," played ").concat(p(r.player.cards)," and won the round. Waiting on ").concat(k(l).name," to start new round."),l}var d=c(c({},e),{},{error:"",discardPile:[].concat(s(e.discardPile),[new j(r.player.name,M(r.player,r.cards))])});return 0===r.player.cards.length?d.message="".concat(r.player.name," played, has no cards left, and is the winner. "):(T(d,D(r.player,e.players)),d.message="".concat(r.player.name," played ").concat(p(r.player.cards),". Waiting on ").concat(k(d))),d}return e})()}));
//# sourceMappingURL=index.js.map